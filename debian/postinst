#!/bin/bash

# SprawdÅº czy Python jest zainstalowany
if ! command -v python3 >/dev/null 2>&1; then
    echo "ğŸ Python3 nie jest zainstalowany. Instalowanie..."
    apt-get update
    apt-get install -y python3 python3-venv python3-pip
fi

# SprawdÅº czy python3-venv jest zainstalowany
if ! python3 -c "import venv" 2>/dev/null; then
    echo "ğŸ Pakiet python3-venv nie jest zainstalowany. Instalowanie..."
    apt-get update
    apt-get install -y python3-venv
fi

# UtwÃ³rz Å›rodowisko wirtualne
echo "ğŸ”§ Tworzenie Å›rodowiska wirtualnego..."
python3 -m venv /usr/share/youtube-downloader/venv

# Zainstaluj zaleÅ¼noÅ›ci w Å›rodowisku wirtualnym
echo "ğŸ“š Instalowanie zaleÅ¼noÅ›ci w Å›rodowisku wirtualnym..."
/usr/share/youtube-downloader/venv/bin/pip install yt-dlp

# Aktualizuj ikony i desktop
if command -v update-icon-caches >/dev/null 2>&1; then
    update-icon-caches /usr/share/icons/hicolor
fi

if command -v update-desktop-database >/dev/null 2>&1; then
    update-desktop-database /usr/share/applications
fi

# UtwÃ³rz katalog logÃ³w uÅ¼ytkownika
if [ -n "$SUDO_USER" ]; then
    USER_HOME=$(getent passwd "$SUDO_USER" | cut -d: -f6)
else
    USER_HOME=$HOME
fi

if [ -n "$USER_HOME" ] && [ -d "$USER_HOME" ]; then
    mkdir -p "$USER_HOME/.youtube-downloader" || true
fi

chmod 755 /usr/bin/youtube-downloader || true
chmod 644 /usr/share/applications/youtube-downloader.desktop || true

echo "âœ… YouTube Downloader v1.0.2 zostaÅ‚ zainstalowany pomyÅ›lnie!"
echo "ğŸš€ Uruchom aplikacjÄ™ komendÄ…: youtube-downloader"
echo "ğŸ“± Lub znajdÅº w menu aplikacji systemu"
echo "ğŸ“ Logi bÄ™dÄ… zapisywane w: ~/.youtube-downloader/youtube_downloader.log"
echo ""
echo "âš ï¸  UWAGA PRAWNA: Ta aplikacja jest narzÄ™dziem technicznym."
echo "UÅ¼ytkownik odpowiada za legalnoÅ›Ä‡ pobierania treÅ›ci."
