#!/bin/bash

case "$1" in
    remove|purge)
        echo "ğŸ—‘ï¸ Usuwanie plikÃ³w aplikacji..."
        
        # UsuÅ„ pliki aplikacji tylko przy remove/purge
        rm -rf /usr/share/youtube-downloader || true
        rm -f /usr/bin/youtube-downloader || true
        rm -f /usr/share/applications/youtube-downloader.desktop || true

        # UsuÅ„ ikony
        rm -f /usr/share/icons/hicolor/*/apps/youtube-downloader.png || true
        ;;
    upgrade|abort-upgrade)
        echo "ğŸ”„ Upgrade - zachowujÄ™ pliki aplikacji"
        ;;
    *)
        echo "ğŸ—‘ï¸ Inne dziaÅ‚anie ($1) - usuwam pliki"
        rm -rf /usr/share/youtube-downloader || true
        rm -f /usr/bin/youtube-downloader || true
        rm -f /usr/share/applications/youtube-downloader.desktop || true
        rm -f /usr/share/icons/hicolor/*/apps/youtube-downloader.png || true
        ;;
esac

# UsuÅ„ logi uÅ¼ytkownika tylko przy purge
case "$1" in
    purge)
        echo "ğŸ—‘ï¸ Usuwanie katalogu roboczego uÅ¼ytkownika..."

# SprawdÅº rÃ³Å¼ne sposoby znalezienia katalogu domowego uÅ¼ytkownika
USER_HOME=""

# SprawdÅº SUDO_USER
if [ -n "$SUDO_USER" ]; then
    USER_HOME=$(getent passwd "$SUDO_USER" | cut -d: -f6 2>/dev/null || echo "")
fi

# JeÅ›li nie znaleziono, sprÃ³buj z LOGNAME
if [ -z "$USER_HOME" ] && [ -n "$LOGNAME" ]; then
    USER_HOME=$(getent passwd "$LOGNAME" | cut -d: -f6 2>/dev/null || echo "")
fi

# JeÅ›li nadal nie znaleziono, uÅ¼yj domyÅ›lnego katalogu
if [ -z "$USER_HOME" ]; then
    USER_HOME="/home/username"
fi

echo "ğŸ” Katalog domowy uÅ¼ytkownika: $USER_HOME"

if [ -n "$USER_HOME" ] && [ -d "$USER_HOME" ]; then
    CONFIG_DIR="$USER_HOME/.youtube-downloader"
    echo "ğŸ—‘ï¸ Usuwanie: $CONFIG_DIR"
    if [ -d "$CONFIG_DIR" ]; then
        rm -rf "$CONFIG_DIR" || echo "âš ï¸ Nie udaÅ‚o siÄ™ usunÄ…Ä‡ katalogu roboczego"
    else
        echo "â„¹ï¸ Katalog roboczy nie istnieje"
    fi
else
    echo "âš ï¸ Nie moÅ¼na znaleÅºÄ‡ katalogu domowego uÅ¼ytkownika"
fi

        echo "âœ… Deinstalacja zakoÅ„czona!"
        echo "ğŸ Åšrodowisko wirtualne zostaÅ‚o usuniÄ™te"
        echo "ğŸ“ Systemowy Python pozostaje nienaruszony"
        ;;
    *)
        echo "âœ… Akcja $1 zakoÅ„czona"
        ;;
esac

exit 0 