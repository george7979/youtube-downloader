#!/bin/bash

case "$1" in
    remove|purge)
        echo "🗑️ Usuwanie plików aplikacji..."
        
        # Usuń pliki aplikacji tylko przy remove/purge
        rm -rf /usr/share/youtube-downloader || true
        rm -f /usr/bin/youtube-downloader || true
        rm -f /usr/share/applications/youtube-downloader.desktop || true

        # Usuń ikony
        rm -f /usr/share/icons/hicolor/*/apps/youtube-downloader.png || true
        ;;
    upgrade|abort-upgrade)
        echo "🔄 Upgrade - zachowuję pliki aplikacji"
        ;;
    *)
        echo "🗑️ Inne działanie ($1) - usuwam pliki"
        rm -rf /usr/share/youtube-downloader || true
        rm -f /usr/bin/youtube-downloader || true
        rm -f /usr/share/applications/youtube-downloader.desktop || true
        rm -f /usr/share/icons/hicolor/*/apps/youtube-downloader.png || true
        ;;
esac

# Usuń logi użytkownika tylko przy purge
case "$1" in
    purge)
        echo "🗑️ Usuwanie katalogu roboczego użytkownika..."

# Sprawdź różne sposoby znalezienia katalogu domowego użytkownika
USER_HOME=""

# Sprawdź SUDO_USER
if [ -n "$SUDO_USER" ]; then
    USER_HOME=$(getent passwd "$SUDO_USER" | cut -d: -f6 2>/dev/null || echo "")
fi

# Jeśli nie znaleziono, spróbuj z LOGNAME
if [ -z "$USER_HOME" ] && [ -n "$LOGNAME" ]; then
    USER_HOME=$(getent passwd "$LOGNAME" | cut -d: -f6 2>/dev/null || echo "")
fi

# Jeśli nadal nie znaleziono, użyj domyślnego katalogu
if [ -z "$USER_HOME" ]; then
    USER_HOME="/home/username"
fi

echo "🔍 Katalog domowy użytkownika: $USER_HOME"

if [ -n "$USER_HOME" ] && [ -d "$USER_HOME" ]; then
    CONFIG_DIR="$USER_HOME/.youtube-downloader"
    echo "🗑️ Usuwanie: $CONFIG_DIR"
    if [ -d "$CONFIG_DIR" ]; then
        rm -rf "$CONFIG_DIR" || echo "⚠️ Nie udało się usunąć katalogu roboczego"
    else
        echo "ℹ️ Katalog roboczy nie istnieje"
    fi
else
    echo "⚠️ Nie można znaleźć katalogu domowego użytkownika"
fi

        echo "✅ Deinstalacja zakończona!"
        echo "🐍 Środowisko wirtualne zostało usunięte"
        echo "📝 Systemowy Python pozostaje nienaruszony"
        ;;
    *)
        echo "✅ Akcja $1 zakończona"
        ;;
esac

exit 0 